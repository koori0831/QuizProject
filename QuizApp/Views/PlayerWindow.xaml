<Window x:Class="QuizApp.Views.PlayerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:QuizApp.Converters"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        mc:Ignorable="d"
        Title="퀴즈 참가자 화면" Height="720" Width="1280" WindowState="Maximized"
        WindowStyle="None" ResizeMode="NoResize" Background="{DynamicResource ApplicationBackgroundBrush}">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:PathToFullPathConverter x:Key="PathToFullPath"/>
        <converters:StringEqualsToVisibilityConverter x:Key="StringEqualsToVis"/>
    </Window.Resources>
    
    <Grid>
        <!-- 1. 메인 화면 (테마 선택) -->
        <Grid Visibility="{Binding IsIdle, Converter={StaticResource BoolToVis}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 상단 바 -->
            <Grid Margin="30">
                <TextBlock Text="QUIZ GAME" FontSize="32" FontWeight="Bold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" VerticalAlignment="Center"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <ui:Button Content="에디터 실행" Icon="{ui:SymbolIcon Edit24}" Command="{Binding OpenEditorCommand}" 
                            Appearance="Secondary" Margin="0,0,10,0"/>
                    <ui:Button Content="종료" Icon="{ui:SymbolIcon Dismiss24}" Command="{Binding ExitApplicationCommand}" 
                            Appearance="Danger"/>
                </StackPanel>
            </Grid>

            <Grid Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="테마를 선택하세요" FontSize="48" FontWeight="ExtraBold" 
                               HorizontalAlignment="Center" Margin="0,0,0,50" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                    
                    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="600" Padding="20">
                        <ItemsControl ItemsSource="{Binding Themes}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel HorizontalAlignment="Center" MaxWidth="1200"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <ui:Button Command="{Binding DataContext.SelectThemeCommand, RelativeSource={RelativeSource AncestorType=Window}}" 
                                            CommandParameter="{Binding}"
                                            Margin="15" Width="300" Height="200" Appearance="Primary" Padding="0">
                                        <Grid>
                                            <Border Background="{DynamicResource SystemControlBackgroundAccentBrush}" Opacity="0.1"/>
                                            <TextBlock Text="{Binding Title}" FontSize="28" FontWeight="Bold" 
                                                       HorizontalAlignment="Center" VerticalAlignment="Center" TextWrapping="Wrap"
                                                       Foreground="White"/>
                                        </Grid>
                                    </ui:Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- 2. 게임 진행 화면 -->
        <Grid Visibility="{Binding IsPlaying, Converter={StaticResource BoolToVis}}" Background="Black">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- 타이머 (상단 고정) -->
            <Border Background="#222" Padding="20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- 패스 기회 표시 (좌측) -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0,0,0"
                                Visibility="{Binding HasPassChance, Converter={StaticResource BoolToVis}}">
                        <ui:SymbolIcon Symbol="ArrowSwap24" FontSize="50" Foreground="{DynamicResource SystemAccentColorBrush}"/>
                        <TextBlock Text="패스 가능" FontSize="45" FontWeight="Bold" Foreground="{DynamicResource SystemAccentColorBrush}" 
                                   VerticalAlignment="Center" Margin="10,0,0,0"/>
                    </StackPanel>

                    <!-- 타이머 (중앙) -->
                    <TextBlock Grid.Column="1" Text="{Binding TimerText}" FontSize="80" FontWeight="Bold" Foreground="#FF5555" 
                               HorizontalAlignment="Center" FontFamily="Consolas"/>
                </Grid>
            </Border>
            
            <!-- 문제 이미지 (최대화) -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 진행도 표시 -->
                <Border Grid.Row="0" Background="#333" Padding="10" HorizontalAlignment="Center" CornerRadius="0,0,10,10" Margin="0,0,0,20">
                    <TextBlock Text="{Binding ProgressText}" FontSize="32" FontWeight="Bold" Foreground="White" 
                               HorizontalAlignment="Center" FontFamily="Consolas"/>
                </Border>

                <Image Grid.Row="1" Source="{Binding CurrentQuestionImage, Converter={StaticResource PathToFullPath}}" 
                       Stretch="Uniform" Margin="20"/>
            </Grid>
        </Grid>

        <!-- 3. 결과 화면 -->
        <Grid Visibility="{Binding IsResult, Converter={StaticResource BoolToVis}}" Background="{DynamicResource ApplicationBackgroundBrush}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ui:SymbolIcon Symbol="Trophy48" FontSize="100" Foreground="{Binding ResultColor}" Margin="0,0,0,20" 
                               Visibility="{Binding ResultMessage, Converter={StaticResource StringEqualsToVis}, ConverterParameter='성공!'}"/>
                
                <TextBlock Text="{Binding ResultMessage}" FontSize="120" FontWeight="Heavy" 
                           Foreground="{Binding ResultColor}" HorizontalAlignment="Center" Margin="0,0,0,50">
                    <TextBlock.Effect>
                        <DropShadowEffect BlurRadius="20" ShadowDepth="5" Opacity="0.3"/>
                    </TextBlock.Effect>
                </TextBlock>
                
                <ui:Button Content="메인으로 돌아가기" Icon="{ui:SymbolIcon Home24}" Command="{Binding BackToMainCommand}" 
                        FontSize="24" Padding="30,15" Appearance="Primary" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>